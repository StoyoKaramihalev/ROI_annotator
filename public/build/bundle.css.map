{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "..\\..\\App.svelte"
  ],
  "sourcesContent": [
    "<script>\r\n  let files = []\r\n  let regionFiles = []\r\n  let selecting = ''\r\n  let r = 8\r\n  let currentTime = 0\r\n  let roi = []\r\n  let circles = []\r\n  let regions = {\r\n    reference: [],\r\n    referenceValue: ''\r\n  }\r\n  let regionCount = 0\r\n  let svg\r\n  let downloadName = 'regions.json'\r\n  let imgEl\r\n  let circleMouseDown = false\r\n\r\n\r\n  const defineClick = (cx, cy) => {\r\n    if (circles.length > 1) {\r\n      let fx = circles[0].x\r\n      let fy = circles[0].y\r\n      if (Math.abs(cx - fx) <= r && Math.abs(cy - fy) <= r){\r\n        cx = fx\r\n        cy = fy\r\n        selecting = ''\r\n      }\r\n    }\r\n\r\n    roi = [...roi, {x: cx, y: cy}]\r\n    circles = [...circles, {x: cx, y: cy}]\r\n  }\r\n  const referClick = (x, y) => {\r\n    if (regions.reference.length >= 2) return\r\n    regions.reference = [...regions.reference, {x, y}]\r\n  }\r\n  const onClick = ({x, y}) => {\r\n    if (selecting === '') return\r\n    let cx = x - svgPos.left\r\n    let cy = y - svgPos.top\r\n\r\n    if (selecting === 'define') defineClick(cx, cy)\r\n    if (selecting === 'refer') referClick(cx, cy)\r\n  }\r\n  const clear = () => {\r\n    circles = []\r\n    roi = []\r\n  }\r\n  const save = () => {\r\n    regions[imgName + '_' + currentTime + (++regionCount)] = { name, points:  roi.slice() }\r\n    roi = []\r\n    circles = []\r\n  }\r\n  const pointify = r => r.map(({x, y}) => `${x},${y}`).join(' ')\r\n  const setSvgWidth = () => {\r\n    svg.style.width = imgEl.clientWidth\r\n    svg.style.height = imgEl.clientHeight\r\n  }\r\n  const circleMouseMove = (e, index, key) => {\r\n    const x = e.clientX - svg.getBoundingClientRect().x\r\n    const y = e.clientY - svg.getBoundingClientRect().y\r\n    regions[key].points[index] = {x, y}\r\n    if (index === 0) regions[key].points[ regions[key].points.length - 1] = {x, y}\r\n    else if (index ===  regions[key].points.length - 1) regions[key].points[0] = {x, y}\r\n  }\r\n  const loadRegion = (e) => {\r\n    if (e.target.files.length === 0) return\r\n    const regionFile = e.target.files[0]\r\n    const reader = new FileReader();\r\n\r\n    reader.onload = evt => {\r\n      regions = Object.assign(regions, JSON.parse(evt.target.result))\r\n    }\r\n\r\n    reader.readAsText(regionFile)\r\n  }\r\n\r\n  $: svgPos = svg && {left: svg.getBoundingClientRect().x, top: svg.getBoundingClientRect().y}\r\n  $: points = pointify(roi)\r\n  $: img = files.length > 0 ? files[0] : null\r\n  $: imgUrl =  img ? URL.createObjectURL(img) : ''\r\n  $: imgName = img ? img.name : 'unknown'\r\n  $: name = 'region_' + regionCount\r\n  $: downloadName = imgName + '.json'\r\n</script>\r\n\r\n<header>\r\n  <h1>ROI annotator</h1>\r\n</header>\r\n\r\n<main>\r\n\t<p>Select image: <input type=\"file\" accept=\"image/*\" bind:files></p>\r\n\t<p>(Optional) Select regions: <input type=\"file\" accept=\"application/JSON\" on:change={loadRegion}></p>\r\n  <p><button class:pointer={selecting === 'refer'} on:click={() => selecting = 'refer'}>Create reference</button>\r\n     <input bind:value={regions.referenceValue} placeholder=\"Reference value\"/></p>\r\n  <button class:pointer={selecting === 'define'} on:click={() => selecting = 'define'}>Define ROI</button>\r\n  <button on:click={clear}>Clear ROI</button>\r\n  <button disabled={roi.length < 4} on:click={save}>Save ROI</button>\r\n  <input bind:value={name} required minlength=\"1\"/>\r\n\r\n  <div class=\"container not-selectable\">\r\n    <svg bind:this={svg} on:click={onClick} class:pointer={selecting !== ''}>\r\n      {#each Object.entries(regions).filter(([k, v]) => v.points) as [key, {name: rname, points}]}\r\n        <text x={points[0].x} y={points[0].y - 5} fill=\"white\" class=\"not-selectable\">{rname}</text>\r\n        <polyline points={pointify(points)} fill=\"none\" stroke=\"darkgreen\" stroke-width=\"2\"/>\r\n        {#each points as point, index}\r\n          <circle cx={point.x} cy={point.y} {r} fill=\"darkgreen\" class=\"point\"\r\n            on:mousemove={e => circleMouseDown && circleMouseMove(e, index, key)}\r\n            on:mousedown={() => circleMouseDown = true}\r\n            on:mouseup={() => circleMouseDown = false}\r\n            on:mouseleave={() => circleMouseDown = false}\r\n            />\r\n        {/each}\r\n      {/each}\r\n      <polyline {points} fill=\"none\" stroke=\"lightblue\" stroke-width=\"2\" stroke-dasharray=\"10,10\"/>\r\n      {#each circles as {x, y}}\r\n        <circle cx={x} cy={y} {r} fill=\"lightblue\"/>\r\n      {/each}\r\n      {#if regions.reference.length > 0}\r\n        <polyline points={pointify(regions.reference)} fill=\"none\" stroke=\"darkred\" stroke-width=\"3\"/>\r\n      {/if}\r\n    </svg>\r\n    <img on:load={setSvgWidth} bind:this={imgEl} src={imgUrl} alt=\"Annotate\"/>\r\n  </div>\r\n\r\n  {#if Object.keys(regions).length > 0}\r\n  <p>\r\n    <a download={downloadName} href={`data:application/json,${JSON.stringify(regions, null, 4)}`}>Download regions</a>\r\n    <input bind:value={downloadName}/>\r\n  </p>\r\n  {/if}\r\n\r\n</main>\r\n\r\n<footer>\r\n  <p>Developed by: <a href=\"https://github.com/mkaramihalev\">Marin Karamihalev</a></p>\r\n  <p><a href=\"https://github.com/StoyoKaramihalev/ROI_annotator\">Repository</a> on GitHub</p>\r\n</footer>\r\n\r\n<style>\r\n\r\n  header {\r\n    text-align: center;\r\n    background: rgb(240, 240, 240);\r\n    padding: 1em;\r\n  }\r\n\r\n\tmain {\r\n\t\ttext-align: center;\r\n\t\tpadding: 1em;\r\n\t\tmax-width: 240px;\r\n    margin: 0 auto;\r\n    background: rgb(255, 255, 255);\r\n    width: 90%;\r\n    height: 70%;\r\n\t}\r\n\r\n  img {\r\n    border-color: black;\r\n    border-width: 5px;\r\n    border-style: dashed;\r\n    border-radius: 3px;\r\n  }\r\n\r\n  .not-selectable {\r\n    user-select: none;\r\n  }\r\n\r\n  .pointer {\r\n    cursor: pointer;\r\n  }\r\n\r\n  .container {\r\n    position: relative;\r\n  }\r\n\r\n  svg {\r\n    z-index: 2;\r\n    position: absolute;\r\n  }\r\n\r\n\timg {\r\n    z-index: 1;\r\n    height: 40vh;\r\n  }\r\n  .point:hover {\r\n    cursor: pointer;\r\n  }\r\n\r\n\t@media (min-width: 640px) {\r\n\t\tmain {\r\n\t\t\tmax-width: none;\r\n\t\t}\r\n\t}\r\n</style>\r\n"
  ],
  "names": [],
  "mappings": "AA8IE,MAAM,eAAC,CAAC,AACN,UAAU,CAAE,MAAM,CAClB,UAAU,CAAE,IAAI,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAC9B,OAAO,CAAE,GAAG,AACd,CAAC,AAEF,IAAI,eAAC,CAAC,AACL,UAAU,CAAE,MAAM,CAClB,OAAO,CAAE,GAAG,CACZ,SAAS,CAAE,KAAK,CACd,MAAM,CAAE,CAAC,CAAC,IAAI,CACd,UAAU,CAAE,IAAI,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAC9B,KAAK,CAAE,GAAG,CACV,MAAM,CAAE,GAAG,AACd,CAAC,AAEA,GAAG,eAAC,CAAC,AACH,YAAY,CAAE,KAAK,CACnB,YAAY,CAAE,GAAG,CACjB,YAAY,CAAE,MAAM,CACpB,aAAa,CAAE,GAAG,AACpB,CAAC,AAED,eAAe,eAAC,CAAC,AACf,WAAW,CAAE,IAAI,AACnB,CAAC,AAED,QAAQ,eAAC,CAAC,AACR,MAAM,CAAE,OAAO,AACjB,CAAC,AAED,UAAU,eAAC,CAAC,AACV,QAAQ,CAAE,QAAQ,AACpB,CAAC,AAED,GAAG,eAAC,CAAC,AACH,OAAO,CAAE,CAAC,CACV,QAAQ,CAAE,QAAQ,AACpB,CAAC,AAEF,GAAG,eAAC,CAAC,AACF,OAAO,CAAE,CAAC,CACV,MAAM,CAAE,IAAI,AACd,CAAC,AACD,qBAAM,MAAM,AAAC,CAAC,AACZ,MAAM,CAAE,OAAO,AACjB,CAAC,AAEF,MAAM,AAAC,YAAY,KAAK,CAAC,AAAC,CAAC,AAC1B,IAAI,eAAC,CAAC,AACL,SAAS,CAAE,IAAI,AAChB,CAAC,AACF,CAAC"
}