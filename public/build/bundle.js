var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function o(e){e.forEach(t)}function r(e){return"function"==typeof e}function l(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t){e.appendChild(t)}function c(e,t,n){e.insertBefore(t,n||null)}function s(e){e.parentNode.removeChild(e)}function u(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function a(e){return document.createElement(e)}function f(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function p(e){return document.createTextNode(e)}function d(){return p(" ")}function h(){return p("")}function g(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function m(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function y(e,t){e.value=null==t?"":t}function $(e,t,n){e.classList[n?"add":"remove"](t)}let v;function x(e){v=e}const b=[],k=[],w=[],O=[],_=Promise.resolve();let j=!1;function R(e){w.push(e)}let C=!1;const S=new Set;function z(){if(!C){C=!0;do{for(let e=0;e<b.length;e+=1){const t=b[e];x(t),N(t.$$)}for(b.length=0;k.length;)k.pop()();for(let e=0;e<w.length;e+=1){const t=w[e];S.has(t)||(S.add(t),t())}w.length=0}while(b.length);for(;O.length;)O.pop()();j=!1,C=!1,S.clear()}}function N(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(R)}}const E=new Set;function L(e,t){-1===e.$$.dirty[0]&&(b.push(e),j||(j=!0,_.then(z)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function A(l,i,c,u,a,f,p=[-1]){const d=v;x(l);const h=i.props||{},g=l.$$={fragment:null,ctx:null,props:f,update:e,not_equal:a,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:n(),dirty:p};let m=!1;if(g.ctx=c?c(l,h,(e,t,...n)=>{const o=n.length?n[0]:t;return g.ctx&&a(g.ctx[e],g.ctx[e]=o)&&(g.bound[e]&&g.bound[e](o),m&&L(l,e)),t}):[],g.update(),m=!0,o(g.before_update),g.fragment=!!u&&u(g.ctx),i.target){if(i.hydrate){const e=function(e){return Array.from(e.childNodes)}(i.target);g.fragment&&g.fragment.l(e),e.forEach(s)}else g.fragment&&g.fragment.c();i.intro&&((y=l.$$.fragment)&&y.i&&(E.delete(y),y.i($))),function(e,n,l){const{fragment:i,on_mount:c,on_destroy:s,after_update:u}=e.$$;i&&i.m(n,l),R(()=>{const n=c.map(t).filter(r);s?s.push(...n):o(n),e.$$.on_mount=[]}),u.forEach(R)}(l,i.target,i.anchor),z()}var y,$;x(d)}function M(e,t,n){const o=e.slice();return o[38]=t[n].x,o[39]=t[n].y,o}function B(e,t,n){const o=e.slice();return o[46]=t[n],o[48]=n,o}function I(e,t,n){const o=e.slice();return o[42]=t[n][0],o[43]=t[n][1].name,o[11]=t[n][1].points,o}function T(e){let t,n,r,l,i;function u(...t){return e[24](e[48],e[42],...t)}return{c(){t=f("circle"),m(t,"cx",n=e[46].x),m(t,"cy",r=e[46].y),m(t,"r",q),m(t,"fill","darkgreen"),m(t,"class","point svelte-1noezos")},m(n,o){c(n,t,o),l||(i=[g(t,"mousemove",u),g(t,"mousedown",e[25]),g(t,"mouseup",e[26]),g(t,"mouseleave",e[27])],l=!0)},p(o,l){e=o,16&l[0]&&n!==(n=e[46].x)&&m(t,"cx",n),16&l[0]&&r!==(r=e[46].y)&&m(t,"cy",r)},d(e){e&&s(t),l=!1,o(i)}}}function V(e){let t,n,o,r,l,a,d,g=e[43]+"",y=e[11],$=[];for(let t=0;t<y.length;t+=1)$[t]=T(B(e,y,t));return{c(){t=f("text"),n=p(g),l=f("polyline");for(let e=0;e<$.length;e+=1)$[e].c();d=h(),m(t,"x",o=e[11][0].x),m(t,"y",r=e[11][0].y-5),m(t,"fill","white"),m(t,"class","not-selectable svelte-1noezos"),m(l,"points",a=e[15](e[11])),m(l,"fill","none"),m(l,"stroke","darkgreen"),m(l,"stroke-width","2")},m(e,o){c(e,t,o),i(t,n),c(e,l,o);for(let t=0;t<$.length;t+=1)$[t].m(e,o);c(e,d,o)},p(e,i){if(16&i[0]&&g!==(g=e[43]+"")&&function(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}(n,g),16&i[0]&&o!==(o=e[11][0].x)&&m(t,"x",o),16&i[0]&&r!==(r=e[11][0].y-5)&&m(t,"y",r),16&i[0]&&a!==(a=e[15](e[11]))&&m(l,"points",a),131344&i[0]){let t;for(y=e[11],t=0;t<y.length;t+=1){const n=B(e,y,t);$[t]?$[t].p(n,i):($[t]=T(n),$[t].c(),$[t].m(d.parentNode,d))}for(;t<$.length;t+=1)$[t].d(1);$.length=y.length}},d(e){e&&s(t),e&&s(l),u($,e),e&&s(d)}}}function H(e){let t,n,o;return{c(){t=f("circle"),m(t,"cx",n=e[38]),m(t,"cy",o=e[39]),m(t,"r",q),m(t,"fill","lightblue")},m(e,n){c(e,t,n)},p(e,r){8&r[0]&&n!==(n=e[38])&&m(t,"cx",n),8&r[0]&&o!==(o=e[39])&&m(t,"cy",o)},d(e){e&&s(t)}}}function J(e){let t,n;return{c(){t=f("polyline"),m(t,"points",n=e[15](e[4].reference)),m(t,"fill","none"),m(t,"stroke","darkred"),m(t,"stroke-width","3")},m(e,n){c(e,t,n)},p(e,o){16&o[0]&&n!==(n=e[15](e[4].reference))&&m(t,"points",n)},d(e){e&&s(t)}}}function D(e){let t,n,o,r,l,u,f,h;return{c(){t=a("p"),n=a("a"),o=p("Download regions"),l=d(),u=a("input"),m(n,"download",e[6]),m(n,"href",r="data:application/json,"+JSON.stringify(e[4],null,4))},m(r,s){c(r,t,s),i(t,n),i(n,o),i(t,l),i(t,u),y(u,e[6]),f||(h=g(u,"input",e[30]),f=!0)},p(e,t){64&t[0]&&m(n,"download",e[6]),16&t[0]&&r!==(r="data:application/json,"+JSON.stringify(e[4],null,4))&&m(n,"href",r),64&t[0]&&u.value!==e[6]&&y(u,e[6])},d(e){e&&s(t),f=!1,h()}}}function W(t){let n,r,l,v,x,b,k,w,O,_,j,R,C,S,z,N,E,L,A,B,T,W,q,U,F,G,P,X,Y,Q,Z,ee,te,ne,oe,re,le,ie,ce=Object.keys(t[4]).length>0,se=Object.entries(t[4]).filter(K),ue=[];for(let e=0;e<se.length;e+=1)ue[e]=V(I(t,se,e));let ae=t[3],fe=[];for(let e=0;e<ae.length;e+=1)fe[e]=H(M(t,ae,e));let pe=t[4].reference.length>0&&J(t),de=ce&&D(t);return{c(){n=a("header"),n.innerHTML="<h1>ROI annotator</h1>",r=d(),l=a("main"),v=a("p"),x=p("Select image: "),b=a("input"),k=d(),w=a("p"),O=p("(Optional) Select regions: "),_=a("input"),j=d(),R=a("p"),C=a("button"),C.textContent="Create reference",S=d(),z=a("input"),N=d(),E=a("button"),E.textContent="Define ROI",L=d(),A=a("button"),A.textContent="Clear ROI",B=d(),T=a("button"),W=p("Save ROI"),U=d(),F=a("input"),G=d(),P=a("div"),X=f("svg");for(let e=0;e<ue.length;e+=1)ue[e].c();Y=f("polyline");for(let e=0;e<fe.length;e+=1)fe[e].c();Q=h(),pe&&pe.c(),Z=d(),ee=a("img"),ne=d(),de&&de.c(),oe=d(),re=a("footer"),re.innerHTML='<p>Developed by: <a href="https://github.com/mkaramihalev">Marin Karamihalev</a></p> \n  <p><a href="https://github.com/StoyoKaramihalev/ROI_annotator">Repository</a> on GitHub</p>',m(n,"class","svelte-1noezos"),m(b,"type","file"),m(b,"accept","image/*"),m(_,"type","file"),m(_,"accept","application/JSON"),m(C,"class","svelte-1noezos"),$(C,"pointer","refer"===t[1]),m(z,"placeholder","Reference value"),m(E,"class","svelte-1noezos"),$(E,"pointer","define"===t[1]),T.disabled=q=t[2].length<4,F.required=!0,m(F,"minlength","1"),m(Y,"points",t[11]),m(Y,"fill","none"),m(Y,"stroke","lightblue"),m(Y,"stroke-width","2"),m(Y,"stroke-dasharray","10,10"),m(X,"class","svelte-1noezos"),$(X,"pointer",""!==t[1]),ee.src!==(te=t[10])&&m(ee,"src",te),m(ee,"alt","Annotate"),m(ee,"class","svelte-1noezos"),m(P,"class","container not-selectable svelte-1noezos"),m(l,"class","svelte-1noezos")},m(e,o){c(e,n,o),c(e,r,o),c(e,l,o),i(l,v),i(v,x),i(v,b),i(l,k),i(l,w),i(w,O),i(w,_),i(l,j),i(l,R),i(R,C),i(R,S),i(R,z),y(z,t[4].referenceValue),i(l,N),i(l,E),i(l,L),i(l,A),i(l,B),i(l,T),i(T,W),i(l,U),i(l,F),y(F,t[9]),i(l,G),i(l,P),i(P,X);for(let e=0;e<ue.length;e+=1)ue[e].m(X,null);i(X,Y);for(let e=0;e<fe.length;e+=1)fe[e].m(X,null);i(X,Q),pe&&pe.m(X,null),t[28](X),i(P,Z),i(P,ee),t[29](ee),i(l,ne),de&&de.m(l,null),c(e,oe,o),c(e,re,o),le||(ie=[g(b,"change",t[19]),g(_,"change",t[18]),g(C,"click",t[20]),g(z,"input",t[21]),g(E,"click",t[22]),g(A,"click",t[13]),g(T,"click",t[14]),g(F,"input",t[23]),g(X,"click",t[12]),g(ee,"load",t[16])],le=!0)},p(e,t){if(2&t[0]&&$(C,"pointer","refer"===e[1]),16&t[0]&&z.value!==e[4].referenceValue&&y(z,e[4].referenceValue),2&t[0]&&$(E,"pointer","define"===e[1]),4&t[0]&&q!==(q=e[2].length<4)&&(T.disabled=q),512&t[0]&&F.value!==e[9]&&y(F,e[9]),164112&t[0]){let n;for(se=Object.entries(e[4]).filter(K),n=0;n<se.length;n+=1){const o=I(e,se,n);ue[n]?ue[n].p(o,t):(ue[n]=V(o),ue[n].c(),ue[n].m(X,Y))}for(;n<ue.length;n+=1)ue[n].d(1);ue.length=se.length}if(2048&t[0]&&m(Y,"points",e[11]),8&t[0]){let n;for(ae=e[3],n=0;n<ae.length;n+=1){const o=M(e,ae,n);fe[n]?fe[n].p(o,t):(fe[n]=H(o),fe[n].c(),fe[n].m(X,Q))}for(;n<fe.length;n+=1)fe[n].d(1);fe.length=ae.length}e[4].reference.length>0?pe?pe.p(e,t):(pe=J(e),pe.c(),pe.m(X,null)):pe&&(pe.d(1),pe=null),2&t[0]&&$(X,"pointer",""!==e[1]),1024&t[0]&&ee.src!==(te=e[10])&&m(ee,"src",te),16&t[0]&&(ce=Object.keys(e[4]).length>0),ce?de?de.p(e,t):(de=D(e),de.c(),de.m(l,null)):de&&(de.d(1),de=null)},i:e,o:e,d(e){e&&s(n),e&&s(r),e&&s(l),u(ue,e),u(fe,e),pe&&pe.d(),t[28](null),t[29](null),de&&de.d(),e&&s(oe),e&&s(re),le=!1,o(ie)}}}let q=8;const K=([e,t])=>t.points;function U(e,t,n){let o,r,l=[],i="",c=[],s=[],u={reference:[],referenceValue:""},a=0,f="regions.json",p=!1;const d=e=>e.map(({x:e,y:t})=>`${e},${t}`).join(" "),h=(e,t,r)=>{const l=e.clientX-o.getBoundingClientRect().x,i=e.clientY-o.getBoundingClientRect().y;n(4,u[r].points[t]={x:l,y:i},u),0===t?n(4,u[r].points[u[r].points.length-1]={x:l,y:i},u):t===u[r].points.length-1&&n(4,u[r].points[0]={x:l,y:i},u)};let g,m,y,$,v,x;return e.$$.update=()=>{32&e.$$.dirty[0]&&(g=o&&{left:o.getBoundingClientRect().x,top:o.getBoundingClientRect().y}),4&e.$$.dirty[0]&&n(11,m=d(c)),1&e.$$.dirty[0]&&n(34,y=l.length>0?l[0]:null),8&e.$$.dirty[1]&&n(10,$=y?URL.createObjectURL(y):""),8&e.$$.dirty[1]&&n(33,v=y?y.name:"unknown"),1&e.$$.dirty[1]&&n(9,x="region_"+a),4&e.$$.dirty[1]&&n(6,f=v+".json")},[l,i,c,s,u,o,f,r,p,x,$,m,({x:e,y:t})=>{if(""===i)return;let o=e-g.left,r=t-g.top;"define"===i&&((e,t)=>{if(s.length>1){let o=s[0].x,r=s[0].y;Math.abs(e-o)<=q&&Math.abs(t-r)<=q&&(e=o,t=r,n(1,i=""))}n(2,c=[...c,{x:e,y:t}]),n(3,s=[...s,{x:e,y:t}])})(o,r),"refer"===i&&((e,t)=>{u.reference.length>=2||n(4,u.reference=[...u.reference,{x:e,y:t}],u)})(o,r)},()=>{n(3,s=[]),n(2,c=[])},()=>{n(4,u[v+"_0"+n(31,++a)]={name:x,points:c.slice()},u),n(2,c=[]),n(3,s=[])},d,()=>{n(5,o.style.width=r.clientWidth,o),n(5,o.style.height=r.clientHeight,o)},h,e=>{if(0===e.target.files.length)return;const t=e.target.files[0],o=new FileReader;o.onload=e=>{n(4,u=Object.assign(u,JSON.parse(e.target.result)))},o.readAsText(t)},function(){l=this.files,n(0,l)},()=>n(1,i="refer"),function(){u.referenceValue=this.value,n(4,u)},()=>n(1,i="define"),function(){x=this.value,n(9,x),n(31,a)},(e,t,n)=>p&&h(n,e,t),()=>n(8,p=!0),()=>n(8,p=!1),()=>n(8,p=!1),function(e){k[e?"unshift":"push"](()=>{o=e,n(5,o)})},function(e){k[e?"unshift":"push"](()=>{r=e,n(7,r)})},function(){f=this.value,n(6,f),n(33,v),n(34,y),n(0,l)}]}const F=new class extends class{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}{constructor(e){super(),A(this,e,U,W,l,{},[-1,-1])}}({target:document.body,props:{}});return"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js"),F}();
//# sourceMappingURL=bundle.js.map
