var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function o(e){return"function"==typeof e}function l(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t){e.appendChild(t)}function c(e,t,n){e.insertBefore(t,n||null)}function s(e){e.parentNode.removeChild(e)}function a(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function f(e){return document.createElement(e)}function u(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function p(e){return document.createTextNode(e)}function h(){return p(" ")}function d(){return p("")}function g(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function v(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function m(e,t){e.value=null==t?"":t}function y(e,t,n,r){e.style.setProperty(t,n,r?"important":"")}function x(e,t,n){e.classList[n?"add":"remove"](t)}let $;function b(e){$=e}const w=[],k=[],O=[],C=[],_=Promise.resolve();let R=!1;function j(e){O.push(e)}let S=!1;const N=new Set;function E(){if(!S){S=!0;do{for(let e=0;e<w.length;e+=1){const t=w[e];b(t),I(t.$$)}for(w.length=0;k.length;)k.pop()();for(let e=0;e<O.length;e+=1){const t=O[e];N.has(t)||(N.add(t),t())}O.length=0}while(w.length);for(;C.length;)C.pop()();R=!1,S=!1,N.clear()}}function I(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(j)}}const A=new Set;function L(e,t){-1===e.$$.dirty[0]&&(w.push(e),R||(R=!0,_.then(E)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function M(l,i,c,a,f,u,p=[-1]){const h=$;b(l);const d=i.props||{},g=l.$$={fragment:null,ctx:null,props:u,update:e,not_equal:f,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:n(),dirty:p};let v=!1;if(g.ctx=c?c(l,d,(e,t,...n)=>{const r=n.length?n[0]:t;return g.ctx&&f(g.ctx[e],g.ctx[e]=r)&&(g.bound[e]&&g.bound[e](r),v&&L(l,e)),t}):[],g.update(),v=!0,r(g.before_update),g.fragment=!!a&&a(g.ctx),i.target){if(i.hydrate){const e=function(e){return Array.from(e.childNodes)}(i.target);g.fragment&&g.fragment.l(e),e.forEach(s)}else g.fragment&&g.fragment.c();i.intro&&((m=l.$$.fragment)&&m.i&&(A.delete(m),m.i(y))),function(e,n,l){const{fragment:i,on_mount:c,on_destroy:s,after_update:a}=e.$$;i&&i.m(n,l),j(()=>{const n=c.map(t).filter(o);s?s.push(...n):r(n),e.$$.on_mount=[]}),a.forEach(j)}(l,i.target,i.anchor),E()}var m,y;b(h)}function B(e,t,n){const r=e.slice();return r[38]=t[n].x,r[39]=t[n].y,r}function T(e,t,n){const r=e.slice();return r[46]=t[n],r[48]=n,r}function V(e,t,n){const r=e.slice();return r[42]=t[n][0],r[43]=t[n][1].name,r[11]=t[n][1].points,r}function D(e){let t,n,o,l,i;function a(...t){return e[24](e[48],e[42],...t)}return{c(){t=u("circle"),v(t,"cx",n=e[46].x),v(t,"cy",o=e[46].y),v(t,"r",K),v(t,"fill","darkgreen"),v(t,"class","point svelte-1fp8hvv")},m(n,r){c(n,t,r),l||(i=[g(t,"mousemove",a),g(t,"mousedown",e[25]),g(t,"mouseup",e[26]),g(t,"mouseleave",e[27])],l=!0)},p(r,l){e=r,16&l[0]&&n!==(n=e[46].x)&&v(t,"cx",n),16&l[0]&&o!==(o=e[46].y)&&v(t,"cy",o)},d(e){e&&s(t),l=!1,r(i)}}}function H(e){let t,n,r,o,l,f,h,g=e[43]+"",m=e[11],y=[];for(let t=0;t<m.length;t+=1)y[t]=D(T(e,m,t));return{c(){t=u("text"),n=p(g),l=u("polyline");for(let e=0;e<y.length;e+=1)y[e].c();h=d(),v(t,"x",r=e[11][0].x),v(t,"y",o=e[11][0].y-5),v(t,"fill","white"),v(t,"class","not-selectable svelte-1fp8hvv"),v(l,"points",f=e[15](e[11])),v(l,"fill","none"),v(l,"stroke","darkgreen"),v(l,"stroke-width","2")},m(e,r){c(e,t,r),i(t,n),c(e,l,r);for(let t=0;t<y.length;t+=1)y[t].m(e,r);c(e,h,r)},p(e,i){if(16&i[0]&&g!==(g=e[43]+"")&&function(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}(n,g),16&i[0]&&r!==(r=e[11][0].x)&&v(t,"x",r),16&i[0]&&o!==(o=e[11][0].y-5)&&v(t,"y",o),16&i[0]&&f!==(f=e[15](e[11]))&&v(l,"points",f),131344&i[0]){let t;for(m=e[11],t=0;t<m.length;t+=1){const n=T(e,m,t);y[t]?y[t].p(n,i):(y[t]=D(n),y[t].c(),y[t].m(h.parentNode,h))}for(;t<y.length;t+=1)y[t].d(1);y.length=m.length}},d(e){e&&s(t),e&&s(l),a(y,e),e&&s(h)}}}function J(e){let t,n,r;return{c(){t=u("circle"),v(t,"cx",n=e[38]),v(t,"cy",r=e[39]),v(t,"r",K),v(t,"fill","lightblue")},m(e,n){c(e,t,n)},p(e,o){8&o[0]&&n!==(n=e[38])&&v(t,"cx",n),8&o[0]&&r!==(r=e[39])&&v(t,"cy",r)},d(e){e&&s(t)}}}function z(e){let t,n;return{c(){t=u("polyline"),v(t,"points",n=e[15](e[4].reference)),v(t,"fill","none"),v(t,"stroke","darkred"),v(t,"stroke-width","2")},m(e,n){c(e,t,n)},p(e,r){16&r[0]&&n!==(n=e[15](e[4].reference))&&v(t,"points",n)},d(e){e&&s(t)}}}function W(e){let t,n,r,o,l,a,u,d,x;return{c(){t=f("div"),n=f("p"),r=f("a"),o=p("Save"),a=h(),u=f("input"),v(r,"download",e[6]),v(r,"href",l="data:application/json,"+JSON.stringify(e[4],null,4)),v(t,"class","row"),y(t,"text-align","center")},m(l,s){c(l,t,s),i(t,n),i(n,r),i(r,o),i(n,a),i(n,u),m(u,e[6]),d||(x=g(u,"input",e[30]),d=!0)},p(e,t){64&t[0]&&v(r,"download",e[6]),16&t[0]&&l!==(l="data:application/json,"+JSON.stringify(e[4],null,4))&&v(r,"href",l),64&t[0]&&u.value!==e[6]&&m(u,e[6])},d(e){e&&s(t),d=!1,x()}}}function q(t){let n,o,l,$,b,w,k,O,C,_,R,j,S,N,E,I,A,L,M,T,D,q,K,U,F,G,X,Y,Q,Z,ee,te,ne,re,oe,le,ie,ce,se,ae,fe,ue,pe,he,de,ge,ve,me,ye,xe,$e,be,we,ke,Oe,Ce,_e=Object.keys(t[4]).length>0,Re=Object.entries(t[4]).filter(P),je=[];for(let e=0;e<Re.length;e+=1)je[e]=H(V(t,Re,e));let Se=t[3],Ne=[];for(let e=0;e<Se.length;e+=1)Ne[e]=J(B(t,Se,e));let Ee=t[4].reference.length>0&&z(t),Ie=_e&&W(t);return{c(){n=f("header"),n.innerHTML='<h1 class="svelte-1fp8hvv">Annotate regions of interest (ROIs)</h1>',o=h(),l=f("hr"),$=h(),b=f("main"),w=f("div"),k=f("div"),O=f("p"),O.textContent="Select image:",C=h(),_=f("p"),_.textContent="Choose a representative frame you wish to annotate.",R=h(),j=f("p"),S=f("input"),N=h(),E=f("div"),I=f("p"),I.textContent="Select regions (optional):",A=h(),L=f("p"),L.textContent="If an ROI file already exists, you may load it here.",M=h(),T=f("p"),D=f("input"),q=h(),K=f("p"),K.textContent="Add reference line:",U=h(),F=f("p"),F.textContent="Draw line between two reference points and input",G=h(),X=f("p"),Y=f("button"),Y.textContent="Draw reference",Q=h(),Z=f("input"),ee=h(),te=f("hr"),ne=h(),re=f("div"),oe=f("button"),oe.textContent="Define ROI",le=h(),ie=f("button"),ie.textContent="Clear ROI",ce=h(),se=f("button"),ae=p("Save ROI"),ue=h(),pe=f("input"),he=h(),de=f("div"),ge=u("svg");for(let e=0;e<je.length;e+=1)je[e].c();ve=u("polyline");for(let e=0;e<Ne.length;e+=1)Ne[e].c();me=d(),Ee&&Ee.c(),ye=h(),xe=f("img"),be=h(),Ie&&Ie.c(),we=h(),ke=f("footer"),ke.innerHTML='<p>Developed by: <a href="https://github.com/mkaramihalev">Marin Karamihalev</a></p> \n  <p>GitHub <a href="https://github.com/StoyoKaramihalev/ROI_annotator">Repository</a></p>',v(n,"class","svelte-1fp8hvv"),v(l,"style","solid"),y(_,"font-size","0.8em"),y(_,"font-style","italic"),v(S,"type","file"),v(S,"accept","image/*"),v(k,"class","column svelte-1fp8hvv"),y(L,"font-size","0.8em"),y(L,"font-style","italic"),v(D,"type","file"),v(D,"accept","application/JSON"),v(E,"class","column svelte-1fp8hvv"),y(F,"font-size","0.8em"),y(F,"font-style","italic"),v(Y,"class","svelte-1fp8hvv"),x(Y,"pointer","refer"===t[1]),v(Z,"placeholder","Reference value"),v(te,"style","solid"),v(oe,"class","svelte-1fp8hvv"),x(oe,"pointer","define"===t[1]),se.disabled=fe=t[2].length<4,pe.required=!0,v(pe,"minlength","1"),v(ve,"points",t[11]),v(ve,"fill","none"),v(ve,"stroke","lightblue"),v(ve,"stroke-width","1"),v(ve,"stroke-dasharray","5,5"),v(ge,"class","svelte-1fp8hvv"),x(ge,"pointer",""!==t[1]),xe.src!==($e=t[10])&&v(xe,"src",$e),v(xe,"alt"," Image for annotation goes here"),v(xe,"class","svelte-1fp8hvv"),v(de,"class","container not-selectable svelte-1fp8hvv"),v(re,"class","row"),y(re,"text-align","center"),v(w,"class","row"),y(w,"line-height","50%"),v(b,"class","svelte-1fp8hvv"),v(ke,"class","svelte-1fp8hvv")},m(e,r){c(e,n,r),c(e,o,r),c(e,l,r),c(e,$,r),c(e,b,r),i(b,w),i(w,k),i(k,O),i(k,C),i(k,_),i(k,R),i(k,j),i(j,S),i(w,N),i(w,E),i(E,I),i(E,A),i(E,L),i(E,M),i(E,T),i(T,D),i(w,q),i(w,K),i(w,U),i(w,F),i(w,G),i(w,X),i(X,Y),i(X,Q),i(X,Z),m(Z,t[4].referenceValue),i(w,ee),i(w,te),i(w,ne),i(w,re),i(re,oe),i(re,le),i(re,ie),i(re,ce),i(re,se),i(se,ae),i(re,ue),i(re,pe),m(pe,t[9]),i(re,he),i(re,de),i(de,ge);for(let e=0;e<je.length;e+=1)je[e].m(ge,null);i(ge,ve);for(let e=0;e<Ne.length;e+=1)Ne[e].m(ge,null);i(ge,me),Ee&&Ee.m(ge,null),t[28](ge),i(de,ye),i(de,xe),t[29](xe),i(w,be),Ie&&Ie.m(w,null),c(e,we,r),c(e,ke,r),Oe||(Ce=[g(S,"change",t[19]),g(D,"change",t[18]),g(Y,"click",t[20]),g(Z,"input",t[21]),g(oe,"click",t[22]),g(ie,"click",t[13]),g(se,"click",t[14]),g(pe,"input",t[23]),g(ge,"click",t[12]),g(xe,"load",t[16])],Oe=!0)},p(e,t){if(2&t[0]&&x(Y,"pointer","refer"===e[1]),16&t[0]&&Z.value!==e[4].referenceValue&&m(Z,e[4].referenceValue),2&t[0]&&x(oe,"pointer","define"===e[1]),4&t[0]&&fe!==(fe=e[2].length<4)&&(se.disabled=fe),512&t[0]&&pe.value!==e[9]&&m(pe,e[9]),164112&t[0]){let n;for(Re=Object.entries(e[4]).filter(P),n=0;n<Re.length;n+=1){const r=V(e,Re,n);je[n]?je[n].p(r,t):(je[n]=H(r),je[n].c(),je[n].m(ge,ve))}for(;n<je.length;n+=1)je[n].d(1);je.length=Re.length}if(2048&t[0]&&v(ve,"points",e[11]),8&t[0]){let n;for(Se=e[3],n=0;n<Se.length;n+=1){const r=B(e,Se,n);Ne[n]?Ne[n].p(r,t):(Ne[n]=J(r),Ne[n].c(),Ne[n].m(ge,me))}for(;n<Ne.length;n+=1)Ne[n].d(1);Ne.length=Se.length}e[4].reference.length>0?Ee?Ee.p(e,t):(Ee=z(e),Ee.c(),Ee.m(ge,null)):Ee&&(Ee.d(1),Ee=null),2&t[0]&&x(ge,"pointer",""!==e[1]),1024&t[0]&&xe.src!==($e=e[10])&&v(xe,"src",$e),16&t[0]&&(_e=Object.keys(e[4]).length>0),_e?Ie?Ie.p(e,t):(Ie=W(e),Ie.c(),Ie.m(w,null)):Ie&&(Ie.d(1),Ie=null)},i:e,o:e,d(e){e&&s(n),e&&s(o),e&&s(l),e&&s($),e&&s(b),a(je,e),a(Ne,e),Ee&&Ee.d(),t[28](null),t[29](null),Ie&&Ie.d(),e&&s(we),e&&s(ke),Oe=!1,r(Ce)}}}let K=8;const P=([e,t])=>t.points;function U(e,t,n){let r,o,l=[],i="",c=[],s=[],a={reference:[],referenceValue:""},f=0,u="regions.json",p=!1;const h=e=>e.map(({x:e,y:t})=>`${e},${t}`).join(" "),d=(e,t,o)=>{const l=e.clientX-r.getBoundingClientRect().x,i=e.clientY-r.getBoundingClientRect().y;n(4,a[o].points[t]={x:l,y:i},a),0===t?n(4,a[o].points[a[o].points.length-1]={x:l,y:i},a):t===a[o].points.length-1&&n(4,a[o].points[0]={x:l,y:i},a)};let g,v,m,y,x,$;return e.$$.update=()=>{32&e.$$.dirty[0]&&(g=r&&{left:r.getBoundingClientRect().x,top:r.getBoundingClientRect().y}),4&e.$$.dirty[0]&&n(11,v=h(c)),1&e.$$.dirty[0]&&n(34,m=l.length>0?l[0]:null),8&e.$$.dirty[1]&&n(10,y=m?URL.createObjectURL(m):""),8&e.$$.dirty[1]&&n(33,x=m?m.name:"unknown"),1&e.$$.dirty[1]&&n(9,$="region_"+f),4&e.$$.dirty[1]&&n(6,u=x+".json")},[l,i,c,s,a,r,u,o,p,$,y,v,({x:e,y:t})=>{if(""===i)return;let r=e-g.left,o=t-g.top;"define"===i&&((e,t)=>{if(s.length>1){let r=s[0].x,o=s[0].y;Math.abs(e-r)<=K&&Math.abs(t-o)<=K&&(e=r,t=o,n(1,i=""))}n(2,c=[...c,{x:e,y:t}]),n(3,s=[...s,{x:e,y:t}])})(r,o),"refer"===i&&((e,t)=>{a.reference.length>=2||n(4,a.reference=[...a.reference,{x:e,y:t}],a)})(r,o)},()=>{n(3,s=[]),n(2,c=[])},()=>{n(4,a[x+"_0"+n(31,++f)]={name:$,points:c.slice()},a),n(2,c=[]),n(3,s=[])},h,()=>{n(5,r.style.width=o.clientWidth,r),n(5,r.style.height=o.clientHeight,r)},d,e=>{if(0===e.target.files.length)return;const t=e.target.files[0],r=new FileReader;r.onload=e=>{n(4,a=Object.assign(a,JSON.parse(e.target.result)))},r.readAsText(t)},function(){l=this.files,n(0,l)},()=>n(1,i="refer"),function(){a.referenceValue=this.value,n(4,a)},()=>n(1,i="define"),function(){$=this.value,n(9,$),n(31,f)},(e,t,n)=>p&&d(n,e,t),()=>n(8,p=!0),()=>n(8,p=!1),()=>n(8,p=!1),function(e){k[e?"unshift":"push"](()=>{r=e,n(5,r)})},function(e){k[e?"unshift":"push"](()=>{o=e,n(7,o)})},function(){u=this.value,n(6,u),n(33,x),n(34,m),n(0,l)}]}const F=new class extends class{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}{constructor(e){super(),M(this,e,U,q,l,{},[-1,-1])}}({target:document.body,props:{}});return"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js"),F}();
//# sourceMappingURL=bundle.js.map
